{
    "name": "Ender3 MicroSwiss DirectDrive",
    "version": 2,
    "inherits": "creality_base",
    "metadata": {
        "quality_definition": "creality_base",
        "visible": true,
        "platform": "creality_ender3.3mf",
        "author": "GitHub.com/RFBomb",

        "machine_extruder_trains": {
            "0": "MicroSwiss_DirectDrive_extruder_0",
            "1": "MicroSwiss_DirectDrive_extruder_1"
        }
    },

    "overrides": {
        "machine_name": { "default_value": "Ender-3 MicroSwiss DirectDrive" },
        "machine_extruder_count": { "value": 1, "maximum_value": "2" },
        "extruders_enabled_count": { "value": 1 },
        "machine_use_extruder_offset_to_offset_coords": { "value": true },
        
        "machine_width": { "value": 230 },
        "machine_depth": { "value": 230 },
        "machine_height": { "value": 175 },
        "gantry_height": { "value": 35 },

        "machine_disallowed_areas": {
            "description": "A list of polygons with areas the print head is not allowed to enter.",
            "default_value": [
                  [[-117.5, 117.5], [-117.5, 108], [117.5, 108], [117.5, 117.5]],
                  [[-117.5, -108], [-117.5, -117.5], [117.5, -117.5], [117.5, -108]]
             ]
        },

        "machine_head_with_fans_polygon": { "default_value": [
                [-26, 34],
                [-26, -32],
                [32, -32],
                [32, 34]
            ]
        },
        
        "retraction_amount": { "default_value": 0.75, "value": 0.75 },
        "retraction_speed": { "default_value": 15.0, "value": 15.0 }, 
        "retraction_extrusion_window": { "value":  "retraction_amount * 2" },

        "machine_heat_zone_length":  { "default_value": 16.0 },
        
        "switch_extruder_retraction_amount": { "value": 16},
        "switch_extruder_retraction_speed": { "value": 15.0 },
        "switch_extruder_prime_speed": { "value": 15.0 },
        "switch_extruder_extra_prime_amount": { "default_value": 0 },
        
        "prime_tower_size": { "default_value": 10.0 },
        "prime_tower_position_x": { "value": 135 },
        "prime_tower_position_y": { "value": 190 },

        "speed_print_layer_0": { "value": 20 },
        "speed_slowdown_layers": { "value": 4 },
        "brim_replaces_support": { "value": true },
        "brim_width": { "value": 5.0 },
        "skirt_gap": { "value": 3.0 },
        "support_z_distance":              { "value": "layer_height * 2" },
        "support_bottom_distance":         { "value": "layer_height" },

        "machine_max_feedrate_x": { "value": 500 },
        "machine_max_feedrate_y": { "value": 500 },
        "machine_max_feedrate_z": { "value": 10 },
        "machine_max_feedrate_e": { "value": 50 },
        "speed_print": { "value": 50.0 } ,
                
        "machine_max_acceleration_x": { "value": 1500 },
        "machine_max_acceleration_y": { "value": 1500 },
        "machine_max_acceleration_z": { "value": 100 },
        "machine_max_acceleration_e": { "value": 5000 },
        "machine_acceleration": { "value": 750 },

        "machine_max_jerk_xy": { "value": 10 },
        "machine_max_jerk_z": { "value": 0.4 },
        "machine_max_jerk_e": { "value": 5 },
        
        "machine_start_gcode": {
            "default_value":  "\n ; Ender 3 Custom Start G-code \n M117 Preheating \n M140 S{material_bed_temperature_layer_0} ; Heat Bed \n M104 T0 S{material_standby_temperature, 0} ; Warm Extruder 1 \n ;M104 T1 S{material_standby_temperature, 1} ; Warm Extruder 2 \n M190 S{material_bed_temperature_layer_0} ; Wait for Heated Bed \n  \n M117 Homing \n G28 ; Home all axes \n G29 A ;Load and Activate the UBL mesh in current Slot \n ;G29 J ; Tilt Mesh Bed Leveling \n M104 T0 S{material_print_temperature_layer_0, 0} ; Set Nozzle 1 Temperature \n ;M104 T1 S{material_print_temperature_layer_0, 1} ; Set Nozzle 2 Temperature \n ;M109 T1 S{material_print_temperature_layer_0, 1} ; Wait for Extruder 2 temperature \n M109 T0 S{material_print_temperature_layer_0, 0} ; Wait for Extruder 1 temperature \n \n ;Purge Nozzle 1 \n M117 Purging... \n T0 \n G92 E0 ; Reset Extruder \n G1 Z5.0 F3000 ; Move Z up \n G1 X0.1 Y40 F5000.0 ; Move to start position \n G1 X0.1 Y41 Z0.30 F5000.0 ; Start Purge Nozzle 1 \n G1      Y190.0 F1500.0 E12.5 ; draw 1st line \n G1 X0.4 Y190.0 F5000.0 ; move to side a little \n G1      Y40 F1500.0 E25 ; draw 2nd line \n G92 E0 ; reset extruder \n  \n ;Purge Nozzle 2  - Assumed that nozzle offsets are X0 Y0 in firmware \n ;Substract 24 from X values if nozzle offsets in firmware (M218) \n ;T1 \n ;G92 E0 ; Reset Extruder \n ;G1 X24.8 ; Move to start position \n ;G1      Y190.0 F1500.0 E12.5 ; draw 1st line \n ;G1 X25.2        F5000.0 ; move to side a little \n ;G1      Y40    F1500.0 E25 ; draw 2nd line \n  \n G1 X25.6 Z0.3 F5000.0 ; Move over to prevent blob squish \n G1 Z5.0 F3000 ; move z up little to prevent scratching of surface \n  \n ;Cooldown Unused Nozzles - Cura will Reheat if needed \n M104 T0 S0 ; Cooldown Extruder 1 \n ;M104 T1 S0 ; Cooldown Extruder 2 \n M104 T{initial_extruder_nr} S{material_print_temperature_layer_0, initial_extruder_nr} ; Keep first used nozzle heated \n T{initial_extruder_nr} \n ; End of custom start GCode \n"
        },
                
        "machine_end_gcode": {
            "default_value": "G91 ;Relative positioning \n G1 E-2 F2700 ;Retract a bit \n G1 E-1 Z0.2 F2400 ;Retract and raise Z \n G1 X5 Y5 F3000 ;Wipe out \n G1 Z10 ;Raise Z more \n G90 ;Absolute positionning \n  \n G1 X0 Y{machine_depth} ;Present print \n M106 S0 ;Turn-off fan \n ;Turn-off hotends \n M104 T0 S0 \n ;M104 T1 S0 \n M140 S0 ;Turn-off bed \n  \n M84 X Y E ;Disable all steppers but Z \n "
        }
        
    }
}
