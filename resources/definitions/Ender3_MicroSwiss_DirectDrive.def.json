{
    "name": "Ender3_MicroSwiss_DirectDrive",
    "version": 3,
    "inherits": "creality_ender3",
    "metadata": {
        "quality_definition": "creality_base",
        "visible": true,
        "platform": "creality_ender3.3mf",
        "author": "GitHub.com/RFBomb",
        "manufacturer": "Custom",

        "machine_extruder_trains": {
            "0": "MicroSwiss_DirectDrive_extruder_0",
            "1": "MicroSwiss_DirectDrive_extruder_1"
        }
    },

    "overrides": {
        "machine_name": { "default_value": "Ender-3 MicroSwiss DirectDrive" },
        "machine_extruder_count": { "default_value": 1, "maximum_value": "2" },
        "extruders_enabled_count": { "default_value": 1 },

        "machine_use_extruder_offset_to_offset_coords": { 
            "description_": "Apply the extruder offset to the coordinate system.",
            "default_value": false 
        },
        
        "machine_width": { "default_value": 230 },
        "machine_depth": { "default_value": 230 },
        "machine_height": { "default_value": 175 },

        "machine_disallowed_areas": {
            "description": "A list of polygons with areas the print head is not allowed to enter.",
            "default_value": [
                  [[-117.5, 117.5], [-117.5, 108], [117.5, 108], [117.5, 117.5]],
                  [[-117.5, -108], [-117.5, -117.5], [117.5, -117.5], [117.5, -108]]
             ]
        },

        "machine_head_with_fans_polygon": { "default_value": [
                [-26, 34],
                [-26, -32],
                [32, -32],
                [32, 34]
            ]
        },

        "gantry_height": { 
            "description": "The height difference between the tip of the nozzle and the gantry system (X and Y axes).",
            "value": 35 
        },
        
        "_Comment_Cura_Keywords":  "http://files.fieldofview.com/cura/Replacement_Patterns.html" ,
        
        "_Comment_Retraction": "MicroSwiss recomends maximum of 1.5mm @ 35mm/s for retraction settings when using their all-metal hot end with Direct Drive extruder",
        "retraction_amount": { "default_value": 0.75 },
        "retraction_extrusion_window": { "default_value":  "retraction_amount * 2" },
        "retraction_speed": { "default_value": 15.0 }, 

        "machine_heat_zone_length":  { 
            "description__": "The distance from the tip of the nozzle in which heat from the nozzle is transferred to the filament.",
            "default_value": 16.0 
        },
        
        "_Comment_ExtruderSwitchingSettings": "Settings to retract material when switching over to the other nozzle",
        "switch_extruder_retraction_amount": { "default_value": "machine_heat_zone_length" , "value": 16},
        "switch_extruder_retraction_speed": { "default_value": 15.0 },
        "switch_extruder_prime_speed": { "default_value": 15.0 },
        "switch_extruder_extra_prime_amount": { "default_value": 0 },
        
        "_Comment_PrimeTower": "Default position for the Prime Tower to reside -> Default Extruder End Code moves here before switching nozzles and waiting for next nozzle to reach temp.",
        "prime_tower_size": { "default_value": 10.0 },
        "prime_tower_position_x": { "default_value": 135 },
        "prime_tower_position_y": { "default_value": 190 },

        "_Comment_Misc_Print_Settings": "Misc default settings that I preferred to tighten up my print consistency",
        "speed_print_layer_0": { "value": 20 },
        "speed_slowdown_layers": { "value": 4 },
        "brim_replaces_support": { "value": true },
        "brim_width": { "value": 5.0 },
        "skirt_gap": { "value": 3.0 },
        "support_z_distance":              { "value": "layer_height * 2" },
        "support_bottom_distance":         { "value": "layer_height" },

        "_Comment_Feedrate": "The maximum speed for the motor of the specified direction. (mm/s)",
        "machine_max_feedrate_x": { "value": 500 },
        "machine_max_feedrate_y": { "value": 500 },
        "machine_max_feedrate_z": { "value": 10 },
        "machine_max_feedrate_e": { "value": 50 },
        "speed_print": { "value": 50.0 } ,
                
        "_Comment_Acceleration": "Maximum acceleration for the motor. (mm/sÂ²)",
        "machine_max_acceleration_x": { "value": 1500 },
        "machine_max_acceleration_y": { "value": 1500 },
        "machine_max_acceleration_z": { "value": 100 },
        "machine_max_acceleration_e": { "value": 5000 },
        "machine_acceleration": { "value": 750 },

        "_Comment_Jerk": "The maximum instantaneous velocity change.",
        "machine_max_jerk_xy": { "value": 10 },
        "machine_max_jerk_z": { "value": 0.4 },
        "machine_max_jerk_e": { "value": 5 },
        
        "machine_start_gcode": {
            "default_value":  ";Ender 3 Custom Start G-code \n M117 Preheating \n M140 S{material_bed_temperature_layer_0} ; Set Heat Bed temperature \n M104 S{material_standby_temperature} ;Warm Extruder just below operating temp \n M190 S{material_bed_temperature_layer_0} ; Wait for Heat Bed temperature \n G28 ; Home all axes \n M117 Auto-Leveling Bed \n ;G29 P1 S0; Auto bed-level (BL-Touch) \n G29 A ;Load and Activate the UBL mesh in Specified Slot \n ;G29 J ; Tilt Mesh BedLeveling \n  \n M117 Getting the extruder up to temp! \n G92 E0 ; Reset Extruder \n M109 S{material_print_temperature_layer_0} ;Wait for Extruder temperature \n  \n ;M104 S{material_print_temperature_layer_0} ; Wait for Extruder temperature \n ;G1 Z5.0 F3000;move z up little to prevent scratching of surface \n ;G1 X0.1 Y40 F5000.0 ; move to start-line position \n ;M109S{material_print_temperature_layer_0} ; Wait for Extruder temperature \n ;M117 Purging... \n ;G1 X0.1 Y41 Z0.30 F5000.0 ; move to start-line position \n ;G1 X0.1 Y190.0 F1500.0 E12.5 ; draw 1st line \n ;G1 X0.4 Y190.0 F5000.0 ; move toside a little \n ;G1 X0.4 Y40 F1500.0 E25 ; draw 2nd line \n ;G92 E0 ; reset extruder \n ;G1 X1 Y40 Z0.3 F5000.0 ; Move over to prevent blob squish \n ;G1 Z5.0 F3000 ; move z up little to prevent scratching of surface \n ; End of custom start GCode \n "
        },
                
        "machine_end_gcode": {
            "default_value": "G91 ;Relative positioning \n G1 E-2 F2700 ;Retract a bit \n G1 E-1 Z0.2 F2400 ;Retract and raise Z \n G1 X5 Y5 F3000 ;Wipe out \n G1 Z10 ;Raise Z more \n G90 ;Absolute positionning \n  \n G1 X0 Y{machine_depth} ;Present print \n M106 S0 ;Turn-off fan \n M104 S0 ;Turn-off hotend \n M140 S0 ;Turn-off bed \n  \n M84 X Y E ;Disable all steppers but Z \n "
        }
        
    }
}
